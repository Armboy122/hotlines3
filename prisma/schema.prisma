generator client {
  provider = "prisma-client-js"
  engineType = "binary"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//
// Enums
//
// VoltageLevel and CableCarEfficiency removed as they were only used in plans

//จุดรวมงาน
model OperationCenter {
  id         BigInt   @id @default(autoincrement())
  name       String

  peas     Pea[]
  stations Station[]
}
//การไฟฟ้า
model Pea {
  id            BigInt   @id @default(autoincrement())
  shortname     String
  fullname      String
  operationId   BigInt

  operationCenter OperationCenter @relation(fields: [operationId], references: [id], onUpdate: Cascade)
}
//สถานี
model Station {
  id           BigInt   @id @default(autoincrement())
  name         String
  codeName     String   @unique
  operationId  BigInt

  operationCenter OperationCenter @relation(fields: [operationId], references: [id], onUpdate: Cascade) 
  feeders         Feeder[]
}
//ฟีดเดอร์
model Feeder {
  id         BigInt   @id @default(autoincrement())
  code       String   @unique
  stationId  BigInt

  station      Station         @relation(fields: [stationId], references: [id], onUpdate: Cascade)
  tasks        TaskDaily[]


  @@index([stationId])
}
//ประเภทงาน
model JobType {
  id         BigInt   @id @default(autoincrement())
  name       String   @unique


  tasks      TaskDaily[]
  jobDetails JobDetail[]
}
//รายละเอียดงาน
model JobDetail {
  id         BigInt   @id @default(autoincrement())
  name       String
  jobTypeId  BigInt?
  createdAt  DateTime @default(now()) @db.Timestamptz(6)
  updatedAt  DateTime @updatedAt @db.Timestamptz(6)
  deletedAt  DateTime? @db.Timestamptz(6)

  jobType JobType?  @relation(fields: [jobTypeId], references: [id], onUpdate: Cascade)
  tasks   TaskDaily[]

  @@unique([name])
  @@index([jobTypeId])
}

//รายงานประจำวัน
model TaskDaily {
  id             BigInt   @id @default(autoincrement())
  workDate       DateTime @db.Date
  teamId         BigInt
  team           Team     @relation(fields: [teamId], references: [id], onUpdate: Cascade)
  jobTypeId      BigInt
  jobDetailId    BigInt
  detail         String?

  feederId       BigInt?
  numPole        String?
  deviceCode     String?

  urlsBefore     String[]         // หลาย URL
  urlsAfter      String[] 

  latitude   Decimal? @db.Decimal(9, 6)
  longitude  Decimal? @db.Decimal(9, 6)

  createdAt      DateTime @default(now()) @db.Timestamptz(6)
  updatedAt      DateTime @updatedAt @db.Timestamptz(6)
  deletedAt      DateTime? @db.Timestamptz(6)

  jobType     JobType    @relation(fields: [jobTypeId], references: [id], onUpdate: Cascade)
  jobDetail   JobDetail  @relation(fields: [jobDetailId], references: [id], onUpdate: Cascade)

  feeder      Feeder?    @relation(fields: [feederId], references: [id], onUpdate: Cascade)

  @@index([workDate])
  @@index([jobTypeId, jobDetailId])
  @@index([feederId])
  @@index([latitude, longitude])
}

model Team {
  id         BigInt   @id @default(autoincrement())
  name       String

  tasks TaskDaily[]
}
